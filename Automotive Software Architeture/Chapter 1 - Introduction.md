## Prefácio
O software é onipresente em nossa sociedade. Ele contra tudo, desde a espinha dorsal da infraestrutura elétrica até os equipamentos de telecomunicações e nossos relógios. Os carros não são exceção, e a quantidade de software nos carros modernos é maior do que em qualquer outro produto de consumo. Certa vez, um colega me perguntou em uma conferência se <font color="#f79646">o carro continuaria funcionando se eliminássemos os componentes eletrônicos</font>. A resposta foi "não", pois basicamente todos os elementos dos carros modernos são controlados por software - motor, freios, limpadores de para-brisa, piscas, rádio, etc. 

Nos últimos anos, a quantidade de software nos carros aumento à medida que a eletrificação, a conectividade e a direção autônoma se tornaram mais predominante em todos os segmentos. A complexidade dos cenários para a direção autônoma é tão grande que os carros podem dirigir de forma autônoma o tempo todo. No entanto, eles podem dirigir em vários cenários sem mudar de faixa, e podem mudar de faixa em determinados cenários ou até mesmo estacionar sozinhos sem ninguém no banco do motorista.

Quando essa complexidade aumenta, <span style="background:rgba(240, 167, 216, 0.55)">enfrentamos novos desafios no projeto de software automotivo</span> - mais funções tornam-se críticas para a segurança, mais funções interagem e os barramentos de comunicação ficam superlotados. Precisamos projetar o software com isso em mente e precisamos fazer isso de uma nova maneira. 

Em 2017, publicamos a primeira edição deste livro, que se tornou popular entre estudantes e profissionais. Muitos leitores entraram em contato comigo e solicitaram determinados elementos, apontaram novos desenvolvimentos importantes e fizeram perguntas. Levei essas sugestões em consideração e, mais uma vez, consegui convencer meus colegas, Dr. Darko Durisic e Dr. Per Johannessen, a ajudar na revisão do livro.

O objetivo do livro é apresentar o conceito de arquitetura de software como um dos pilares do software em carros modernos. O livro é o resultado de meu trabalho na área de engenharia de software, com foco especial em sistemas de segurança e medição de software. Ao longo de minha pesquisa, trabalhei com várias empresas nos <span style="background:rgba(240, 167, 216, 0.55)">domínios automotivo</span> e de telecomunicações e notei que, com o tempo, esses domínios se tornaram cada vez mais semelhantes. <span style="background:rgba(240, 167, 216, 0.55)">Os processos e as ferramentas para o desenvolvimento de software em carros</span> modernos <span style="background:rgba(240, 167, 216, 0.55)">tornaram-se muito semelhantes aos usados no desenvolvimento de sistemas de telecomunicações</span>. O mesmo se aplica às arquiteturas de software - inicialmente muito diferentes, hoje eles são cada vez mais semelhantes em termos de estilos arquitetônicos, paradigmas de programação e padrões arquitetônicos. 

O livro começa com uma visão geral histórica da evolução do software nos carros modernos e a descrição dos principais desafios que impulsionam essa evolução. 
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 2</span> descreve os principais <span style="background:rgba(240, 167, 216, 0.55)">estilos de arquitetura</span> de software automotivo e seu uso no software dos carros. 
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 3</span> é um novo acréscimo, no qual aprendemos sobre as arquiteturas de software modernas - federadas e centralizadas. 
No <span style="background:rgba(240, 200, 0, 0.2)">capítulo 4</span>, o leitor encontrará uma descrição dos processos de desenvolvimento de software usados para desenvolver software no lado do fabricante do carro. 
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 5</span> apresenta a #AUTOSAR, um importante padrão de software automotivo. 
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 6</span> vai além da arquitetura simples e descreve o processo de projeto detalhado do software automotivo com o uso do Simulink, o que nos ajuda a entender como o projeto detalhado se vincula ao projeto de alto nível.
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 7</span> é novo e se concentra no <span style="background:rgba(240, 167, 216, 0.55)">aprendizado de máquina</span> no desenvolvimento de software automotivo.
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 8</span> apresenta um método para avaliar a qualidade da arquitetura - ATAM (Architecture Trade-off Analysis Method) - e fornece um exemplo de avaliação.
O <span style="background:rgba(240, 200, 0, 0.2)">capítulo 9</span> apresenta uma maneira alternativa de avaliar a arquitetura, ou seja, usando medidas e indicadores quantitativos.
No <span style="background:rgba(240, 200, 0, 0.2)">capítulo 10</span>, nos aprofundamos em uma das propriedades específicas discutidas no Cap. 11 - segurança - e podemos ler sobre o importante padrão nessa área - ISO/IEC 26262. Desta vez, este capítulo contém mais informações sobre o hardware do que na primeira edição do livro. Por fim, o Cap. 12 apresenta um conjunto de tendências futuras que parecem surgir hoje e que têm o potencial de moldar a engenharia de software automotivo nos próximos anos.

## Introdução

### Resumo
Os carros modernos evoluíram de dispositivos mecânicos para sistemas ciberfísicos distribuídos que dependem de software para funcionar corretamente. A partir da década de 1970, a quantidade de eletrônicos e softwares usados aumentou gradualmente de um computador (Unidade de Controle Eletrônico, ECU) para 150 ECUs em 2015. A tendência da arquitetura, no entanto, muda à medida que as empresas procuram maneiras de diminuir o número de nós de computação central e conectá-los ao maior número de nós de E/S. Neste capítulo, fornecemos uma visão geral do livro e das convenções usadas nele e apresentamos os exemplos que usaremos ao longo do livro. Descrevemos a história do software automotivo, ancorando os eventos na evolução do mercado de eletrônicos e software nos carros modernos. No final do capítulo, também descrevemos as direções que podem ser seguidas para aprofundar o conhecimento do software automotivo. 

## 1.1 Software and Modern Cars
A introdução do software nos carros abriu muitas oportunidades - desde a otimização do desempenho dos carros até recursos interessantes de infoentretenimento. Os carros modernos são repletos de eletrônicos e os consumidores estão procurando plataformas de carros que se assemelhem totalmente a produtos de software. Um bom exemplo desse tipo de carro é a Tesla, que é conhecida por inovações impulsionadas por software. O fabricante é conhecido por oferecer constantemente novas versões de software aos clientes, fornecendo a eles recursos novos e interessantes quase todos os dias.
Os sistemas de software intensivo dos carros modernos oferecem muitas novas oportunidades, mas também <span style="background:rgba(240, 167, 216, 0.55)">exigem um projeto</span>, <span style="background:rgba(240, 167, 216, 0.55)">uma implementação</span>, uma verificação e uma validação mais cuidadosos antes de serem liberados para os usuários. E, embora as práticas de engenharia de software incluam métodos e ferramentas capazes de atender às necessidades de segurança e confiabilidade do software automotivo, elas devem ser aplicadas de maneira específica para atender a essas necessidades. 
Pudemos ver o claro desenvolvimento da indústria automotiva em um campo menos dominado pela engenharia mecânica, mas com um componente crescente de engenharia eletrônica e de software. Vivemos a evolução do software de simples. Podemos observar que a tendência do uso de software não é diminuir, mas aumentar de acordo com o uso contínuo de software a medida que ele aumenta.
Com a crescente quantidade e importância do software nos carros modernos, podemos observar o aumento da necessidade de engenharia de software profissional. <font color="#f79646">Processos rigorosos</font> de engenharia de software levam a um <span style="background:rgba(240, 167, 216, 0.55)">software de maior qualidade</span>, <span style="background:rgba(240, 167, 216, 0.55)">com complexidade não superior à necessária</span> e <span style="background:rgba(240, 167, 216, 0.55)">garantindo que o software não contribua para fatalidades</span> nas condições de tráfego.
Uma das práticas da <span style="background:rgba(240, 167, 216, 0.55)">engenharia de software</span> é o <span style="background:rgba(240, 167, 216, 0.55)">projeto de alto nível de sistemas de software</span>, também chamado de **arquitetura de software**. A **arquitetura de software** oferece aos projetistas a possibilidade de prescrever como as funções do software são distribuídas aos componentes do software e como os componentes devem interagir entre si. A arquitetura de software geralmente é feita nos estágios iniciais do desenvolvimento do software e serve como base para a alocação dos módulos de software aos componentes e para a distribuição (chamada de sistematização) das funções aos componentes de software.

## 1.1 History of Software in the Automotive Industry
Embora hoje seja um dado adquirido que há uma grande quantidade de software em nossos carros, não era assim no início do setor automotivo. Os primeiros carros não continham nenhum sistema eletrônico, que só entrou no mercado automotivo na década de 1970 com a introdução da injeção eletrônica de combustível como resposta à demanda por eficiência de combustível [CC11]. 
Na década de 1970, o software dos carros era geralmente incorporado profundamente nos componentes eletrônicos em funções relacionadas a domínios únicos - por exemplo, injeção eletrônica de combustível no trem de força, ignição eletrônica no sistema elétrico ou travamento central. Como o uso de componentes eletrônicos era escasso naquela década, a noção de segurança funcional não estava relacionada ao software e era relativamente fácil de incorporar mecanismos para controlar a segurança das funções. As arquiteturas do software geralmente eram monólitos que não se comunicavam com outras partes do software.
Foi a década de 1980 que trouxe inovações com os computadores centrais que podiam exibir a telemetria básica dos veículos, como o consumo de combustível atual, o consumo médio de combustível e a distância percorrida. A capacidade de exibir as informações para os motoristas abriu novas possibilidades. Na frente do software incorporado, os algoritmos de software controlavam novas funções, como freios antibloqueio (ABS) e até mesmo caixas de câmbio eletrônicas.

A década de 1990 introduziu ainda mais eletrônicos visíveis ao consumidor. A inovação mais notável foi no domínio do infroentretenimento e foi o sistema de navegação - ou, como é comumente chamado, o GPS. A visualização das informações on-line exigia a integração de componentes eletrônicos importantes, como o computador de controle do trem de força, o receptor GPS dedicado e a tela de infoentretenimento. Na mesma década também introduziu mais eletrônicos e softwares em áreas críticas para a segurança, como ACC (Adaptative Cruise Control), que controlava a velocidade de um veículo com base na velocidade dos veículos à frente. A introdução desse tipo de funcionalidade levantou questões importantes de responsabilidade por acidentes causados por mau funcionamento do software. A arquitetura de software automotivo usado na década de 1990 era mais distribuída e o software passou a ser reconhecido como um fator importante de inovação no setor automotivo. 
Esse tipo de desenvolvimento continuou nos anos 2000, quando o <span style="background:rgba(240, 167, 216, 0.55)">software começou a dominar</span> a inovação no <span style="background:rgba(240, 167, 216, 0.55)">setor automobilístico</span>. Foi também durante os anos 2000 que a noção de sistemas avançados de suporte ao motorista foi cunhada. O termo "avançado" se referia a funções que integravam vários computadores no carro e tomavam decisões mais "difíceis" para o motorista. Um dos sistemas mais notáveis nessa área foi o sistema City Safety introduzido pela Volvo em seu modelo XC60 [Ern13]. O sistema podia parar o carro a uma velocidade inferior a 50 km/h quando um obstáculo aparecia na frente dele e o motorista não tinha tempo para reagir. Foram esses tipos de sistemas que exigiram mais controle sobre as interações e priorizações complexas e, portanto, levaram a arquiteturas de software mais avançadas. O padrão #AUTOSAR foi introduzido para oferecer a possibilidade de comunicar soluções (quando possível) e facilitar a mudança de plataforma de hardware com o esforço limitado para adotar o software, além de permitir o compartilhamento mais fácil dos componentes entre os fabricantes e introduzir um "**sistema operacional**" comum para os computadores de carro [Dur15, DSTH14].


## Off-topic
O Adaptive Cruise Control ( #ACC), também conhecido como <font color="#f79646">controle de cruzeiro adaptativo</font>, é uma tecnologia automotiva que melhora o sistema de controle de cruzeiro convencional. Enquanto o <font color="#f79646">controle de cruzeiro padrão</font> permite que os motoristas definam uma velocidade constante para o veículo, o ACC vai além ao ajustar automaticamente a velocidade do veículo para manter uma distância segura em relação ao veículo à frente.

O ACC utiliza sensores, como radares ou câmeras, para detectar a distância do veículo à frente e ajusta a velocidade do veículo de acordo com as condições do tráfego. Se o veículo à frente diminuir a velocidade ou parar, o ACC reduzirá a velocidade do seu veículo para manter uma distância segura. Quando o tráfego começa a fluir novamente, o ACC acelerará o veículo até a velocidade definida pelo motorista ou até o limite de velocidade permitido.

A #Tesla utiliza uma forma avançada de controle de cruzeiro adaptativo (ACC) em seus veículos, chamada de "**Traffic-Aware Cruise Control**" (Controle de Cruzeiro Consciente do Tráfego). Este sistema utiliza uma combinação de #radar, #sensores #ultrassônicos e câmeras para monitorar o tráfego ao redor do veículo.

O **Traffic-Aware Cruise Control** da Tesla é capaz de ajustar automaticamente a velocidade do veículo para manter uma distância segura em relação ao veículo à frente, sem a necessidade de intervenção do motorista. Ele pode até mesmo parar o veículo completamente e retomar a aceleração conforme necessário, dependendo das condições do tráfego.

\---------------/

Por fim, a década de 2010 introduziu uma maneira completamente nova de projetar os componentes eletrônicos dos carros. Partindo da rede distribuída de computadores em um único carro, essa década introduziu os conceitos de carros sem fio, comunicação car-2-car, comunicação car-2-infraestrutura e conceitos de direção autônoma. Muitos novos atores surgiram no mercado em que o carro não era mais um produto final, mas uma plataforma em que novas funções podiam ser implantadas mesmo após a produção. Exemplos desses carros são os carros da Tesla ou o veículo autônomo do Google. Foi também essa década que exigiu um controle mais avançado sobre a execução de software proveniente de diferentes fornecedores para a possibilidade de **adicionar novas funcionalidades aos carros sem a necessidade de modificá-los fisicamente**. 
Nos carros atuais, o tamanho do software cresce para mais de 100 milhões de linhas de código, de acordo com Viswanathan.

## 1.3 Tendências que Moldam o desenvolvimento de software automotivo
Em 2007, Pretschner et al descreveram as principais tendências no desenvolvimento de software em sistemas automotivos. Desde então, esse trabalho tem sido um definidor de tendências e prenunciou o grande aumento na quantidade de software automotivo - em 2007 medido em megabytes e em 2016 medido em gigabytes. As cinco tendências de sistemas de software automotivo apresentadas por Prtschner et al. são:
1. Heterogeneidade do software - o software dos carros modernos realiza diferentes funções em diferentes domínios. Esses domínios variam de <span style="background:rgba(240, 167, 216, 0.55)">altamente críticos</span> para a segurança (por exemplo, segurança ativa) a centrados na <span style="background:rgba(240, 167, 216, 0.55)">experiência do usuário</span> (por exemplo, infoentretenimento). Isso significa que as formas de especificar, projetar, implementar e verificar o software variam entre os domínios.
2. <font color="#f79646">Distribuição de mão de obra</font> - o desenvolvimento dos sistemas de software geralmente é distribuído entre OEMs (Fabricantes de Equipamentos Originais, como Volvo, BMW e Audi) automotivos e fornecedores. Os fornecedores também costumam ter a opção de definir sua própria maneira de trabalhar, desde que cumpram os requisitos e os contratos com os OEMs.
3. <font color="#f79646">Distribuição de software</font> - o sistema de software automotivo compreende várias ECUs, e cada um dos computadores tem seu próprio software que precisa cooperar com outras ECUs para cumprir suas funções. Isso implica mais dificuldades na coordenação do software e introduz mais complexidade. 
4. <font color="#f79646">Variantes e configurações</font> - o mercado automotivo globalizado e altamente competitivo exige personalizações do mesmo carro bom base nos requisitos do país e do usuário. Isso significa que o software dos carros modernos precisa ser capaz de funcionar em diferentes países sem a necessidade de recertificação e, portanto, o software precisa lidar com variantes de várias maneiras, tanto no código-fonte quanto no tempo de execução.
5. <font color="#f79646">Modelos de custos baseados em unidades</font> - o mercado competitivo significa que o preço unitário do carro não pode ser muito alto em comparação com a concorrência e, portanto, é comum que os OEMs automotivos otimizem o hardware e o software de forma que os custos unitários permaneçam baixos, enquanto os custos de desenvolvimento podem ser mais altos.

Muita coisa aconteceu desde 2007 e as principais tendências do mercado automotivo atual podem ser complementadas com tendências como:
1. <font color="#f79646">Conectividade e cooperação</font> - a capacidade de usar funções da Internet por meio de redes móveis permitiu que os carros se conectassem entre si e/ou usassem informações da infraestrutura para tomar decisões. Projetos de pesquisa na área de sistemas de transporte inteligentes exploram ideais como o planejamento de velocidade de um ônibus para minimizar a necessidade de frear no "vermelho" ao se aproximar de cruzamentos. Espera-se que os carros modernos sejam capazes de se conectar a smartphones via Bluetooth e usar recursos da Internet, como navegadores da Web ou serviços de músicas.
2. <font color="#f79646">Funções autônomas</font> - a capacidade do carro de frear, dirigir e assumir autonomamente o controle do motorista implica uma grande complexidade em sistemas críticos de segurança, mas é vista como "a próxima grande novidade" no setor automotivo. Isso também significa que os métodos de verificação e validação de software em carros se tornarão ainda mais rigorosos e avançados.

Os cenários de direção autônoma são desafiadores devido à necessidade de se ter um modelo preciso e exato do ambiente físico do carro. Essa demanda por precisão exige **equipamentos de medição mais sofisticados** e, portanto, mais dados para processar, mais pontos de decisão e, por sua vez, algoritmos mais complexos. Um desses equipamentos de medição usados na direção autônoma é o #LIDAR. 
O dispositivo oferece uma visão de 360° dos arredores e permite que o software do carro encontre objetos nas proximidades do carro. Um LIDAR geralmente é um complemento de um RADAR, que normalmente é colocado na frente do veículo. 

É interessante observar o mercado de software automotivo atual e, portanto, acreditamos que este livro será útil para qualquer pessoa interessada em começar a trabalhar com engenharia de software automotivo.

## 1.4 Organização de Sistemas de Software Automotivo
Ao longo dos anos, cada fabricante de automóveis (muitas vezes chamado de OEM, Original Equipment Manufactures) desenvolveu sua própria maneira de organizar os sistemas de software com a diversidade de marcas de automóveis atuais. No entanto, muitos dos fabricantes de automóveis <font color="#f79646">projetam o software de maneira semelhante</font> - eles usam o <font color="#f79646">modelo de desenvolvimento V</font> e uma organização semelhante dos sistemas elétrico (e de software) em domínios e subsistemas. 
Nessa visão, podemos ver que o sistema elétrico é organizado em **domínios**, como infoentretenimento e trem de força. Cada um desses domínios tem um <span style="background:rgba(240, 167, 216, 0.55)">conjunto específico de propriedades</span> - alguns são **críticos para a segurança** e outros não, alguns são muito orientados para o usuário e outros são em tempo real incorporados. Cada um desses domínios, no entanto, é organizado em subsistemas que agrupam uma funcionalidade específica (alguns OEMs chamam esses subsistemas simplesmente de "sistemas"), como segurança ativa, suporte avançado ao motorista e similares. Esses sistemas agrupam vários elementos lógicos e realizam a funcionalidade, que geralmente é agrupada em funções. As funções são geralmente chamadas de funções de ponta a ponta, pois realizam a funcionalidade do usuário, como o Adaptative Cruise Control, o Line DepartureWarning e a navegação de A a B.

As funções são realizadas por subsistemas do sistema elétrico e são ortogonais à organização de subsistemas, componentes e módulos. Por isso, vemos com frequência o conceito de "arquitetura funcional (visualização)", que descreve as dependências entre as funções. 

Cada subsistema contém vários componentes que incluem partes menores de elementos de software que realizam partes da funcionalidade (por exemplo, essa parte pode ser um corretor de mensagens para um sistema de infoentretenimento). Esses componentes são organizados em módulos de software, que geralmente são arquivos de código-fonte com um conjunto de classes, métodos e funções de linguagem de programação. Os agrupamentos dessas funções de linguagem de programação ou classes de software são chamados de componentes lógicos de software.

O termo arquitetura de software pode ser usado em quase todos os níveis dessa hierarquia (exceto no mais baixo). Podemos falar sobre a arquitetura EE (Eletrical System architectura, arquitetura do sistema elétrico), que descreve a organização de software e hardware para todo o carro. Podemos falar de uma arquitetura de ECU que descreve a organização lógica de subsistemas de software, componentes e módulos na ECU. Dependendo do tamanho e da função da ECU, podemos ter módulos, componentes ou subsistemas na ECU.
Os métodos e técnicas apresentados neste livro podem ser aplicados em qualquer um desses níveis.

## 1.5 Arquitetura como uma Disciplina
A arquitetura de software é um tipo de artefato no desenvolvimento de software, mas a arquitetura é uma disciplina completa com suas próprias atividades e tarefas. Muitas vezes, os arquitetos de software são vistos como mais experientes do que os designers sênior e recebem um mandato maior para tomar decisões do que os designers de software. Para evitar confusão, vamos discutir brevemente a função dos arquitetos de software em contrato com os designers e gerentes de projeto. Essas duas funções podem ser percebidas como sobrepostas até certo ponto e, portanto, essa comparação se torna interessante.

## 1.5.1 Arquiteto vs. Gerente de projetos
Ser um arquiteto de software significa exercer um tipo de liderança tecnológica. Os arquitetos são as pessoas que estabelecem as bases para o desenvolvimento de todo o sistema - em termos de estilos arquitetônicos gerais, mas também em termos de princípios que orientam o desenvolvimento do sistema. Esses princípios formam os limites dentro dos quais os projetistas podem fazer suas escolhas. A função do arquiteto é garantir que esses princípios sejam seguidos durante o ciclo de vida do sistema de software. 
De certa forma, a definição das estruturas para o design do sistema é um correspondente técnico à definição das estruturas para o custo e o escopo do projeto que desenvolve o sistema. Entretanto, é responsabilidade do gerente de projeto definir e monitorar o escopo, o cronongrama e o custo do projeto. 